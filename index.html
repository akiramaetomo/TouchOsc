<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Simple Synthesizer</title>
  <style>
    #synthArea {
      width: 100%;
      height: 400px;
      border: 1px solid black;
      touch-action: none;
      position: relative;
    }
    .waveform-selector {
      margin: 10px;
    }
  </style>
</head>
<body>

<h1>Simple Synthesizer</h1>

<div class="waveform-selector">
  <label for="waveform">Waveform:</label>
  <select id="waveform">
    <option value="sine">Sine</option>
    <option value="sawtooth">Sawtooth</option>
    <option value="square">Square</option>
    <option value="triangle">Triangle</option>
  </select>
</div>

<div id="synthArea"></div>

<script>
  const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  let oscillator;
  let gainNode;

  const synthArea = document.getElementById('synthArea');
  const waveformSelect = document.getElementById('waveform');
  let isPlaying = false;

  function startOscillator(frequency, volume) {
    oscillator = audioCtx.createOscillator();
    gainNode = audioCtx.createGain();
    oscillator.type = waveformSelect.value;
    oscillator.frequency.setValueAtTime(frequency, audioCtx.currentTime);
    gainNode.gain.setValueAtTime(volume, audioCtx.currentTime);

    oscillator.connect(gainNode);
    gainNode.connect(audioCtx.destination);
    oscillator.start();
  }

  function stopOscillator() {
    if (oscillator) {
      oscillator.stop();
      oscillator.disconnect();
      gainNode.disconnect();
    }
  }

  function calculateFrequency(yPosition) {
    const minFrequency = 220; // 1/2 of 440Hz
    const maxFrequency = 880; // 2x of 440Hz
    const height = synthArea.clientHeight;
    const relativeY = height - yPosition;
    const frequency = minFrequency + (relativeY / height) * (maxFrequency - minFrequency);
    return frequency;
  }

  function calculateVolume(xPosition) {
    const width = synthArea.clientWidth;
    const volume = (xPosition / width) * 0.5; // Volume range: 0 to 0.5 (-12dB)
    return volume;
  }

  synthArea.addEventListener('mousedown', (event) => {
    const frequency = calculateFrequency(event.clientY);
    const volume = calculateVolume(event.clientX);
    startOscillator(frequency, volume);
    isPlaying = true;
  });

  synthArea.addEventListener('mouseup', () => {
    stopOscillator();
    isPlaying = false;
  });

  synthArea.addEventListener('mousemove', (event) => {
    if (isPlaying) {
      const frequency = calculateFrequency(event.clientY);
      const volume = calculateVolume(event.clientX);
      oscillator.frequency.setValueAtTime(frequency, audioCtx.currentTime);
      gainNode.gain.setValueAtTime(volume, audioCtx.currentTime);
    }
  });

  synthArea.addEventListener('touchstart', (event) => {
    const touch = event.touches[0];
    const frequency = calculateFrequency(touch.clientY);
    const volume = calculateVolume(touch.clientX);
    startOscillator(frequency, volume);
    isPlaying = true;
  });

  synthArea.addEventListener('touchend', () => {
    stopOscillator();
    isPlaying = false;
  });

  synthArea.addEventListener('touchmove', (event) => {
    if (isPlaying) {
      const touch = event.touches[0];
      const frequency = calculateFrequency(touch.clientY);
      const volume = calculateVolume(touch.clientX);
      oscillator.frequency.setValueAtTime(frequency, audioCtx.currentTime);
      gainNode.gain.setValueAtTime(volume, audioCtx.currentTime);
    }
  });

</script>

</body>
</html>
